-- Clean migration script - Dec 8, 2025
-- This removes all old tables and creates a fresh schema

-- Drop all old tables
DROP TABLE IF EXISTS public.conversation_references CASCADE;
DROP TABLE IF EXISTS public.ai_messages CASCADE;
DROP TABLE IF EXISTS public.ai_conversations CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_income_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_jan CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_may CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_transactions_dec CASCADE;
DROP TABLE IF EXISTS public.monthly_income_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_income_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_income_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_income_may CASCADE;
DROP TABLE IF EXISTS public.monthly_income_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_income_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_income_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_income_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_income_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_income_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_income_dec CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_may CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_budget_dec CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_may CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_debts_dec CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_may CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_wishlist_dec CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_feb CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_mar CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_apr CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_may CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_jun CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_jul CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_aug CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_sep CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_oct CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_nov CASCADE;
DROP TABLE IF EXISTS public.monthly_settings_dec CASCADE;
DROP TABLE IF EXISTS public.user_settings CASCADE;
DROP TABLE IF EXISTS public.categories CASCADE;
DROP TABLE IF EXISTS public.payment_methods CASCADE;
DROP TABLE IF EXISTS public.accounts CASCADE;
DROP TABLE IF EXISTS public.currencies CASCADE;
DROP TABLE IF EXISTS public.months CASCADE;
DROP TABLE IF EXISTS public.monthly_budgets CASCADE;
DROP TABLE IF EXISTS public.income_items CASCADE;
DROP TABLE IF EXISTS public.budget_categories CASCADE;
DROP TABLE IF EXISTS public.transactions CASCADE;
DROP TABLE IF EXISTS public.annual_goals CASCADE;
DROP TABLE IF EXISTS public.financial_goals CASCADE;
DROP TABLE IF EXISTS public.wish_list CASCADE;
DROP TABLE IF EXISTS public.todo_list CASCADE;

-- Drop all views
DROP VIEW IF EXISTS public.view_annual_summary CASCADE;
DROP VIEW IF EXISTS public.view_monthly_summary CASCADE;
DROP VIEW IF EXISTS public.view_settings_all CASCADE;
DROP VIEW IF EXISTS public.view_wishlist_all CASCADE;
DROP VIEW IF EXISTS public.view_debts_all CASCADE;
DROP VIEW IF EXISTS public.view_budget_all CASCADE;
DROP VIEW IF EXISTS public.view_income_all CASCADE;
DROP VIEW IF EXISTS public.view_transactions_all CASCADE;

-- Drop all functions
DROP FUNCTION IF EXISTS public.update_ai_conversation_updated_at() CASCADE;
DROP FUNCTION IF EXISTS public.update_conversation_on_message() CASCADE;
DROP FUNCTION IF EXISTS public.update_updated_at_column() CASCADE;
DROP FUNCTION IF EXISTS public.recalculate_budget_actuals_jan() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_jan() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_jan() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_feb() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_feb() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_mar() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_mar() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_apr() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_apr() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_may() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_may() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_jun() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_jun() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_jul() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_jul() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_aug() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_aug() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_sep() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_sep() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_oct() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_oct() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_nov() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_nov() CASCADE;
DROP FUNCTION IF EXISTS public.calculate_debt_ending_balance_dec() CASCADE;
DROP FUNCTION IF EXISTS public.update_budget_variance_dec() CASCADE;
